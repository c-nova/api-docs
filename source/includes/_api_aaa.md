# 認証, 認可, アカウント

<!--===================================================================-->
## 概要
<!--===================================================================-->

このサービスは独立した新しいカウントの作成と、アカウントの回復を提供します。もし現在のアカウントに紐付いたサブアカウントの作成を行う場合には、 [アカウント](#アカウント) を参照してください。

<!--===================================================================-->
## アカウントの作成
<!--===================================================================-->

これはアカウントに新規のユーザー及びスーパーユーザーを作成する際に使用します。作成プロセスの一部として、サービスはリンクを含んだ確認用のEメールを送信し、ユーザーはそれをクリックしてアカウントのアクティベーションを行う必要があります（アカウントはアクティブ化するまで使用することはできません）

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/create_account --data "email=[EMAIL]&password=[PASSWORD]"
```

=======
### HTTP要求

`POST https://login.eagleeyenetworks.com/g/aaa/create_account`

パラメータ  		| データ型式   | 詳細          	| 以下で必須
---------  		| ----------- | -----------   	| -----------
**email**   	| 文字列      | Eメールアドレス 	| POST
**password**   	| 文字列      | パスワード 		| POST
name   			| 文字列      | アカウント名
realm  			| 文字列      | レルム (デフォルトは現在のユーザーレルム)
first_name 		| 文字列      | ユーザーの名前
last_name  		| 文字列      | ユーザーの姓
timezone   		| 文字列      | タイムゾーン名
is_api_acces_needed | ブール | この新規アカウントにAPIアクセス権を与える

### エラー状態コード

HTTP 状態コード    | データ型式   
------------------- | -----------
400	| 無効なセッションクッキーにより認証されませんでした
406	| レルムがルート・レルムではないため不正です
409	| Eメールアドレスが指定されたレルムに既に登録済みです
202	| アカウントは作成され、提供されたEメールアドレスに対して確認Eメールが送信されました

<!--===================================================================-->
## アカウントの確認
<!--===================================================================-->

これはアカウントの作成時に提供された電子メールアドレスを確認するために使用されます。成功するとアカウントはアクティブに設定され、ユーザーセッションが作成されます。ユーザーは再度ログインする必要はありません。

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/validate_account --data "id=[ID]&token=[TOKEN]"
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/validate_account`

パラメータ  | データ型式     | 詳細         | 必須？
--------- | ---------   | ----------- | -----------
**id**    | 文字列      | アカウントID  | true
**token** | 文字列      | アカウント検証トークン | true

> JSON 応答

```json
{
    "user_id": "ca103fea"
}
```

### HTTP要求

`POST https://login.eagleeyenetworks.com/g/aaa/validate_account`

パラメータ  		| データ型式   | 詳細          	| 以下で必須
---------  		| ----------- | -----------   	| -----------
id   		| 文字列      | アカウントID 		| POST
token   	| 文字列      | アカウント検証トークン | POST

### HTTP Json Attributes

パラメータ 	| データ型式     | 詳細       
---------  	| -----------   | -----------
user_id 	| 文字列 		| 検証されたユーザーの一意の識別子

### エラー状態コード

HTTP 状態コード    | データ型式   
------------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
406	| 検証できな情報が与えられました
409	| アカウントは既にアクティブ化済みです
412	| ユーザーが無効です
460	| アカウントは非アクティブです
200	| ユーザーにレルムに対してのアクセス許可を与えられました

<!--===================================================================-->
## パスワードの紛失
<!--===================================================================-->

パスワードリカバリは、複数のステップからなるプロセスです：

  - ステップ1は、登録されたユーザーの電子メールアドレスにリセット電子メールを送信するよう要求します。
  - ステップ2では、リセットトークンが有効であることを検証します（この手順はオプションですが、より快適なユーザーエクスペリエンスを提供するために提供されています）。
  - ステップ3を使用して、ユーザーはパスワードを変更できます。 ステップ3の結果は、ユーザーセッションがユーザー用に作成されていることです。

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/forgot_password --data "email=[EMAIL]"
```

### HTTP要求

`POST https://login.eagleeyenetworks.com/g/aaa/forgot_password`

パラメータ  		| データ型式   | 詳細          	| 必須
---------  		| ----------- | -----------   	| -----------
**email**   	| 文字列      | Eメール アドレス 	| True

### エラー状態コード

HTTP 状態コード        | データ型式   
------------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
406	| 検証できな情報が与えられました
412	| ユーザーが無効です
460	| アカウントは非アクティブです
461	| アカウントは保留中です
462	| ユーザーは保留中です
202	| 指定されたEメールアドレスにリセット用のEメールが送信されました。これはEメールアドレスが見つからなかった場合でも実行されます。これにより、攻撃者がユーザーアカウントを探す事を防くことができます。

<!--===================================================================-->
## パスワードのリセット トークンの確認
<!--===================================================================-->

これはパスワード回復/リセットプロセスのステップ2です。提供されたトークンが有効なリセット トークンであることを確認します。

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/check_pw_reset_token --data "token=[TOKEN]"
```

### HTTP要求

`POST https://login.eagleeyenetworks.com/g/aaa/check_pw_reset_token`

パラメータ  		 | データ型式     | 詳細           	| 必須？
---------  		| ----------- | -----------   	| -----------
**token**   	| 文字列       | 電子メールでパスワードリセットトークンを提供 | True

### エラー状態コード

HTTP 状態コード       | 詳細   
------------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
406	| 検証できな情報が与えられました
412	| ユーザーが無効です
460	| アカウントは非アクティブです
461	| アカウントは保留中です
202	| トークンは有効です

<!--===================================================================-->
## パスワードのリセット
<!--===================================================================-->

これはパスワード回復/リセットプロセスのステップ3です。どちらも、提供されたトークンが有効なリセットトークンであることを検証し、有効であればトークンに関連付けられたパスワードを新しく提供されたパスワードにリセットします。完了すると、ユーザーログインセッションが作成されます

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/reset_password --data "token=[TOKEN]&password=[PASSWORD]"
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/reset_password`

パラメータ                       | データ型式   | 詳細         | 必須？
---------                      | --------- | ----------- | -----------
**token**                      | 文字列     | Eメールで提供されたパスワード リセット トークン | true
**password**                   | 文字列     | 新しいパスワード | true
accepted_terms_of_service_urls | 文字列     | 新しい利用規約の確認URL

> JSON 応答

```json
{
    "user_id": "ca0e1cf2"
}
```

### HTTP 応答 (JSON 属性)

パラメータ   | データ型式  | 詳細
--------- | --------- | -----------
user_id   | 文字列     | 検証されたユーザーの一意の識別子

### エラー状態コード

HTTP 状態コード    | 詳細
---------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
406	| 検証できな情報が与えられました
412	| ユーザーが無効です
460	| アカウントは非アクティブです
461	| アカウントは保留中です
200	| ユーザーにレルムに対してのアクセス許可を与えられました

<!--===================================================================-->
## 登録用Eメールの再送
<!--===================================================================-->

アカウントに登録ずみであるにもかかわらず、登録の確認していないユーザーに使用します。これにより、登録確認メールを再送信することができます

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/resend_registration_email --data "email=[EMAIL]"
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/resend_registration_email`

パラメータ   | データ型式  | 詳細        	| 必須？
--------- | --------- | ----------- | -----------
**email** | 文字列     | 保留中のアカウントのアカウント担当者のEメールアドレス | true
realm     | 文字列     | レルム (デフォルトは現在のユーザーレルム)

### エラー状態コード

HTTP 状態コード     | 詳細
---------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
404	| 指定されたEメール アドレスとレルムのユーザーが見つかりません
409	| アカウントは既にアクティブ化済みです（非保留）
412	| ユーザーが無効です
460	| アカウントは非アクティブです
202	| ユーザーは存在し、検証ため保留状態になりました。確認Eメールが再作成され、Eメールアドレスに送信されました

<!--===================================================================-->
## ユーザー確認用Eメールの再送
<!--===================================================================-->

ユーザーアカウントが作成済みであるにもかか、ユーザーアカウントを確認していないユーザーに使用します。これにより、ユーザーに確認メールを再送信することができます

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/aaa/resend_user_verification_email --data "email=[EMAIL]"
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/resend_user_verification_email`

パラメータ   | データ型式  | 詳細        	| 必須？
--------- | --------- | ----------- | -----------
**email** | 文字列     | 新規ユーザーのEメール アドレス | true
realm     | 文字列     | レルム (デフォルトは現在のユーザーレルム)

### エラー状態コード

HTTP 状態コード     | 詳細
---------------- | -----------
400 | 予期せぬまたは識別不能な引数が与えられました
402	| アカウントは停止中です
404	| 指定されたEメール アドレスとレルムのユーザーが見つかりません
409	| アカウントは既にアクティブ化済みです（非保留）
412	| ユーザーが無効です
460	| アカウントは非アクティブです
461	| アカウントは保留中です
202	| ユーザーは存在し、検証ため保留状態になりました。確認Eメールが再作成され、Eメールアドレスに送信されました

<!--===================================================================-->
## パスワードの変更
<!--===================================================================-->

これを使用することで、認証済みのユーザーはパスワードを直接変更することができます。また、スーパーユーザーは管理対象のユーザーのパスワードを変更することもできます。

  - 自分のパスワードを変更する際には、現在のパスワードも入力する必要があります（ユーザーIDは省略）
  - 管理対象のユーザーのパスワードを変更する際には、（管理対象ユーザーのIDとは別に）新しいパスワードのみが必要です

> 要求

```shell
curl --cookie "auth_key=[AUTH_KEY]&api_key=[API_KEY]" --request POST https://login.eagleeyenetworks.com/g/aaa/change_password --data "password=[PASSWORD]&current_password=[CURRENT_PASSWORD]"
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/change_password`

パラメータ         | データ型式   | 詳細         | 必須？
---------        | --------- | ----------- | -----------
**password**     | 文字列    | 新しいパスワード | true
id               | 文字列    | パスワードを変更したユーザのID。これはオプションです。デフォルトでは認証されたユーザーのIDです。空の場合、または認証されたユーザと等しい場合は、「current_password」が必要になります
current_password | 文字列    | ユーザーの現在のパスワード。これはオプションです。"id"引数が空であるか、認証されたユーザのIDと等しい場合、この項目は必須です

> JSON 応答

```json
{
    "id": "ca02c000"
}
```

### HTTP 応答 (JSON 属性)

パラメータ   | データ型式  | 詳細
--------- | --------- | -----------
id        | 文字列    | パスワードを変更したユーザーの一意の識別子

### エラー状態コード

HTTP 状態コード | 詳細
---------------- | -----------
400	| 予期せぬまたは識別不能な引数が与えられました
401	| 無効なセッションクッキーにより認証されませんでした
404	| 提供された `'id'` のユーザーは見つかりませんでした
406	| 提供された `'current_password'` は認証されたユーザーのパスワードと一致しませんでした

<!--===================================================================-->
## アカウントの切り替え
<!--===================================================================-->

ユーザーは、アクセス権を持つ別のアカウントに「ログイン」することができます（[アカウント一覧の取得]（＃get-list-of-accounts）を参照）。一般的には、これは、サブアカウントにアクセスするマスターアカウントユーザーに必要な機能です。 [アカウント]（＃アカウント）モデルのアカウントにのみ適用されます

> 要求

```shell
curl --cookie "auth_key=[AUTH_KEY]" --request POST https://login.eagleeyenetworks.com/g/aaa/switch_account
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/switch_account`

パラメータ    | データ型式  | 詳細
---------  | --------- | -----------
account_id | 文字列    | ログインするアカウントのID。これはオプションです。デフォルトはユーザーが所属するアカウントのIDです

### エラー状態コード

HTTP 状態コード     | 詳細
---------------- | -----------
400	| 予期せぬまたは識別不能な引数が与えられました
401	| 無効なセッションクッキーにより認証されませんでした
404	| `'account_id'` が提供されているアカウントが見つかりませんでした
200	| アカウントのコンテキスト切り替えに成功しました

<!--===================================================================-->
## シングル・サインオン
<!--===================================================================-->

<aside class="success">このサービスは現在開発中であり、まだ機能していません</aside>

SSOを使用すると、リセラーはアカウント管理を維持しながら、ユーザーがIDプロバイダシステムにログインした後にシステムプロキシにEagle Eye Networkサーバーへの認証要求を行うためのIDプロバイダとして機能することができます

これは標準のSAML（Security Assertion Markup Language）によって行われます。そのため、IDプロバイダは **brand_saml_publickey_ret** および **brand_saml_namedid_path** でアカウントを設定します

  - **brand_saml_publickey_cert** は、Eagle Eye NetworksがSSOメッセージが有効であることを検証し、改ざんされていないことを検証するための公開鍵を含むx509証明書です。この証明書の形式はPEMです（アスキーコード化されたベース64は、**'----- BEGIN CERTIFICATE--’** および **'--END CERTIFICATE--’** を含む行で囲まれています）

  - **brand_saml_namedid_path** は、ログインしているユーザーの電子メールアドレスを含むノードへのxml xpathです

アイデンティティプロバイダのアカウントがSSO用に登録されると、アイデンティティプロバイダはユーザを検証し、ユーザの電子メールアドレスとリターンリンクを使用してシングルサインオン要求を行うことができます
この64ビットの暗号化されたメッセージはヘッダーから展開され、saml公開鍵で使用するためにデコードと検証が行われます
次に、samlという名前のIDパスを使用して、ユーザーの電子メールが抽出され、そのユーザーに対してauth_keyが提供されます

> 要求

```shell
curl --request POST https://login.eagleeyenetworks.com/g/sso
```

### HTTP要求

`POST https://login.eagleeyenetworks.com/g/sso`

### エラー状態コード

HTTP 状態コード    | 詳細
---------------- | -----------
400	| 予期せぬまたは識別不能な引数が与えられました
401	| 無効なセッションクッキーにより認証されませんでした
404	| `'account_id'` が提供されているアカウントが見つかりませんでした
200	| アカウントコンテキストの切り替えに成功しました

<!--===================================================================-->
## ログアウト
<!--===================================================================-->

ユーザーをログアウトして、HTTPセッションCookieを無効にします

> 要求

```shell
curl --cookie "auth_key=[AUTH_KEY]" --request POST https://login.eagleeyenetworks.com/g/aaa/logout
```

### HTTP 要求

`POST https://login.eagleeyenetworks.com/g/aaa/logout`

### エラー状態コード

HTTP 状態コード     | 詳細
---------------- | -----------
400	| 予期せぬまたは識別不能な引数が与えられました
204	| ユーザーはログアウトされました
